# Documentación de bases de datos (RDS y Excel)

**Resumen**
- La app precarga todas las fuentes en `global.R` al iniciar.
- Los RDS se leen con `readRDS(...)` y quedan en objetos `DATA_*` y listas `DATA_BY_*`.
- El Excel `tables.xlsx` se carga una sola vez en `EXCEL_TABLES` y se consulta con `get_excel_table(...)`.
- En `tabs/server/non_salary.R` se usan las listas `LABOR_DATA_SOURCES_*` y helpers `get_group_data`, `get_component_data`, `get_payer_data`.
- En `tabs/server/non_salary_cost.R` se usan variables locales (`tabla`, `df_non_salary`, etc.) y los mismos helpers.

**RDS usados por la aplicación**

| Categoría | Archivo (ruta) | Nombre en memoria / alias | Uso (breve) | Dónde se llama |
| --- | --- | --- | --- | --- |
| Base (across) | `data/non_salary/bonuses_and_benefits_component.rds` | `DATA_TABLA`; también `DATA_BY_COMPONENT$bonuses_and_benefits` | Tabla base de componentes de bonos y beneficios. | `global.R` (carga). `tabs/server/non_salary_cost.R` como `tabla`. `tabs/server/non_salary.R` como `data_sources$tabla` y `get_component_data("bonuses_and_benefits")`. |
| Base (across) | `data/non_salary/1. total_non_salary_costs.rds` | `DATA_NON_SALARY` (alias `data_sources$non_salary`) | Costos no salariales totales (across). | `global.R` (carga). `tabs/server/non_salary_cost.R` como `df_non_salary`. `tabs/server/non_salary.R` vía `LABOR_DATA_SOURCES_ACROSS`. |
| Base (across) | `data/non_salary/2. total_ns_costs_by_payer.rds` | `DATA_NON_SALARY_PAYER` (alias `data_sources$non_salary_payer`) | Costos no salariales por payer (across). | `global.R` (carga). `tabs/server/non_salary_cost.R` como `df_non_salary_payer`. `tabs/server/non_salary.R` vía `LABOR_DATA_SOURCES_ACROSS`. |
| Base (across) | `data/non_salary/total_ns_costs_by_component.rds` | `DATA_NON_SALARY_COMPONENT` (alias `data_sources$non_salary_component`) | Costos no salariales por componente (across). | `global.R` (carga). `tabs/server/non_salary_cost.R` como `df_non_salary_component`. `tabs/server/non_salary.R` vía `LABOR_DATA_SOURCES_ACROSS`. |
| Within (tenure) | `data/non_salary/wage_tenure_variation/total_non_salary_costs_within_tenure.rds` | `DATA_NON_SALARY_WITHIN` (alias `data_sources$non_salary`) | Totales no salariales con filtro de tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `LABOR_DATA_SOURCES_WITHIN`. |
| Within (tenure) | `data/non_salary/wage_tenure_variation/total_ns_costs_by_payer_within_tenure.rds` | `DATA_NON_SALARY_PAYER_WITHIN` (alias `data_sources$non_salary_payer`) | Totales por payer con tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `LABOR_DATA_SOURCES_WITHIN`. |
| Within (tenure) | `data/non_salary/wage_tenure_variation/total_ns_costs_by_component_within_tenure.rds` | `DATA_NON_SALARY_COMPONENT_WITHIN` (alias `data_sources$non_salary_component`) | Totales por componente con tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `LABOR_DATA_SOURCES_WITHIN`. |
| Within (sin tenure) | `data/non_salary/wage_variation/total_non_salary_costs_within.rds` | `DATA_NON_SALARY_WITHIN_NO_TENURE` (alias `data_sources$non_salary`) | Totales no salariales sin tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `LABOR_DATA_SOURCES_WITHIN_NO_TENURE`. |
| Within (sin tenure) | `data/non_salary/wage_variation/total_ns_costs_by_payer_within.rds` | `DATA_NON_SALARY_PAYER_WITHIN_NO_TENURE` (alias `data_sources$non_salary_payer`) | Totales por payer sin tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `LABOR_DATA_SOURCES_WITHIN_NO_TENURE`. |
| Within (sin tenure) | `data/non_salary/wage_variation/total_ns_costs_by_component_within.rds` | `DATA_NON_SALARY_COMPONENT_WITHIN_NO_TENURE` (alias `data_sources$non_salary_component`) | Totales por componente sin tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `LABOR_DATA_SOURCES_WITHIN_NO_TENURE`. |
| Grupo (all) | `data/non_salary/bonuses_and_benefits_all.rds` | `DATA_BY_GROUP$bonuses_and_benefits` (alias `data_sources$group_data$bonuses_and_benefits`) | Serie completa de bonos/beneficios para gráficos y hover. | `global.R` (carga). `tabs/server/non_salary.R` y `tabs/server/non_salary_cost.R` vía `get_group_data("bonuses_and_benefits")`. También `bonus_hover_source`. |
| Grupo (all) | `data/non_salary/payroll_taxes_all.rds` | `DATA_BY_GROUP$payroll_taxes` | Serie completa de payroll taxes. | `global.R` (carga). `tabs/server/non_salary.R` y `tabs/server/non_salary_cost.R` vía `get_group_data("payroll_taxes")`. |
| Grupo (all) | `data/non_salary/pensions_all.rds` | `DATA_BY_GROUP$pensions` | Serie completa de pensiones. | `global.R` (carga). `tabs/server/non_salary.R` y `tabs/server/non_salary_cost.R` vía `get_group_data("pensions")`. |
| Grupo (all) | `data/non_salary/health_all.rds` | `DATA_BY_GROUP$health` | Serie completa de salud. | `global.R` (carga). `tabs/server/non_salary.R` y `tabs/server/non_salary_cost.R` vía `get_group_data("health")`. |
| Grupo (all) | `data/non_salary/occupational_risk_all.rds` | `DATA_BY_GROUP$occupational_risk` | Serie completa de riesgo ocupacional. | `global.R` (carga). `tabs/server/non_salary.R` y `tabs/server/non_salary_cost.R` vía `get_group_data("occupational_risk")`. |
| Grupo (within tenure) | `data/non_salary/wage_tenure_variation/bonuses_and_benefits_within_tenure.rds` | `DATA_BY_GROUP_WITHIN$bonuses_and_benefits` | Bonos/beneficios con tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_group_data("bonuses_and_benefits")` con `LABOR_DATA_SOURCES_WITHIN`. |
| Grupo (within tenure) | `data/non_salary/wage_tenure_variation/payroll_taxes_within_tenure.rds` | `DATA_BY_GROUP_WITHIN$payroll_taxes` | Payroll taxes con tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_group_data("payroll_taxes")` con `LABOR_DATA_SOURCES_WITHIN`. |
| Grupo (within tenure) | `data/non_salary/wage_tenure_variation/pensions_within_tenure.rds` | `DATA_BY_GROUP_WITHIN$pensions` | Pensiones con tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_group_data("pensions")` con `LABOR_DATA_SOURCES_WITHIN`. |
| Grupo (within tenure) | `data/non_salary/wage_tenure_variation/health_within_tenure.rds` | `DATA_BY_GROUP_WITHIN$health` | Salud con tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_group_data("health")` con `LABOR_DATA_SOURCES_WITHIN`. |
| Grupo (within tenure) | `data/non_salary/wage_tenure_variation/occupational_risk_within_tenure.rds` | `DATA_BY_GROUP_WITHIN$occupational_risk` | Riesgo ocupacional con tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_group_data("occupational_risk")` con `LABOR_DATA_SOURCES_WITHIN`. |
| Grupo (within sin tenure) | `data/non_salary/wage_variation/bonuses_and_benefits_within.rds` | `DATA_BY_GROUP_WITHIN_NO_TENURE$bonuses_and_benefits` | Bonos/beneficios sin tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_group_data("bonuses_and_benefits")` con `LABOR_DATA_SOURCES_WITHIN_NO_TENURE`. |
| Grupo (within sin tenure) | `data/non_salary/wage_variation/payroll_taxes_within.rds` | `DATA_BY_GROUP_WITHIN_NO_TENURE$payroll_taxes` | Payroll taxes sin tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_group_data("payroll_taxes")` con `LABOR_DATA_SOURCES_WITHIN_NO_TENURE`. |
| Grupo (within sin tenure) | `data/non_salary/wage_variation/pensions_within.rds` | `DATA_BY_GROUP_WITHIN_NO_TENURE$pensions` | Pensiones sin tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_group_data("pensions")` con `LABOR_DATA_SOURCES_WITHIN_NO_TENURE`. |
| Grupo (within sin tenure) | `data/non_salary/wage_variation/health_within.rds` | `DATA_BY_GROUP_WITHIN_NO_TENURE$health` | Salud sin tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_group_data("health")` con `LABOR_DATA_SOURCES_WITHIN_NO_TENURE`. |
| Grupo (within sin tenure) | `data/non_salary/wage_variation/occupational_risk_within.rds` | `DATA_BY_GROUP_WITHIN_NO_TENURE$occupational_risk` | Riesgo ocupacional sin tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_group_data("occupational_risk")` con `LABOR_DATA_SOURCES_WITHIN_NO_TENURE`. |
| Componente (within tenure) | `data/non_salary/wage_tenure_variation/bonuses_and_benefits_by_component_within_tenure.rds` | `DATA_BY_COMPONENT_WITHIN$bonuses_and_benefits` | Bonos/beneficios por componente con tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_component_data("bonuses_and_benefits")` con `LABOR_DATA_SOURCES_WITHIN`. |
| Componente (within sin tenure) | `data/non_salary/wage_variation/bonuses_and_benefits_by_component_within.rds` | `DATA_BY_COMPONENT_WITHIN_NO_TENURE$bonuses_and_benefits` | Bonos/beneficios por componente sin tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_component_data("bonuses_and_benefits")` con `LABOR_DATA_SOURCES_WITHIN_NO_TENURE`. |
| Componente (within sin tenure) | `data/non_salary/wage_variation/payroll_taxes_by_component_within.rds` | `DATA_BY_COMPONENT_WITHIN_NO_TENURE$payroll_taxes` | Payroll taxes por componente sin tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_component_data("payroll_taxes")` con `LABOR_DATA_SOURCES_WITHIN_NO_TENURE`. |
| Payer (all) | `data/non_salary/pensions_payer.rds` | `DATA_BY_PAYER$pensions` (alias `data_sources$payer_data$pensions`) | Serie por payer para pensiones. | `global.R` (carga). `tabs/server/non_salary.R` y `tabs/server/non_salary_cost.R` vía `get_payer_data("pensions")`. |
| Payer (all) | `data/non_salary/health_payer.rds` | `DATA_BY_PAYER$health` | Serie por payer para salud. | `global.R` (carga). `tabs/server/non_salary.R` y `tabs/server/non_salary_cost.R` vía `get_payer_data("health")`. |
| Payer (all) | `data/non_salary/payroll_taxes_payer.rds` | `DATA_BY_PAYER$payroll_taxes` | Serie por payer para payroll taxes. | `global.R` (carga). `tabs/server/non_salary.R` y `tabs/server/non_salary_cost.R` vía `get_payer_data("payroll_taxes")`. |
| Payer (within tenure) | `data/non_salary/wage_tenure_variation/pensions_by_payer_within_tenure.rds` | `DATA_BY_PAYER_WITHIN$pensions` | Pensions por payer con tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_payer_data("pensions")` con `LABOR_DATA_SOURCES_WITHIN`. |
| Payer (within tenure) | `data/non_salary/wage_tenure_variation/health_by_payer_within_tenure.rds` | `DATA_BY_PAYER_WITHIN$health` | Health por payer con tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_payer_data("health")` con `LABOR_DATA_SOURCES_WITHIN`. |
| Payer (within tenure) | `data/non_salary/wage_tenure_variation/payroll_taxes_by_payer_within_tenure.rds` | `DATA_BY_PAYER_WITHIN$payroll_taxes` | Payroll taxes por payer con tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_payer_data("payroll_taxes")` con `LABOR_DATA_SOURCES_WITHIN`. |
| Payer (within sin tenure) | `data/non_salary/wage_variation/pensions_by_payer_within.rds` | `DATA_BY_PAYER_WITHIN_NO_TENURE$pensions` | Pensions por payer sin tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_payer_data("pensions")` con `LABOR_DATA_SOURCES_WITHIN_NO_TENURE`. |
| Payer (within sin tenure) | `data/non_salary/wage_variation/health_by_payer_within.rds` | `DATA_BY_PAYER_WITHIN_NO_TENURE$health` | Health por payer sin tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_payer_data("health")` con `LABOR_DATA_SOURCES_WITHIN_NO_TENURE`. |
| Payer (within sin tenure) | `data/non_salary/wage_variation/payroll_taxes_by_payer_within.rds` | `DATA_BY_PAYER_WITHIN_NO_TENURE$payroll_taxes` | Payroll taxes por payer sin tenure. | `global.R` (carga). `tabs/server/non_salary.R` vía `get_payer_data("payroll_taxes")` con `LABOR_DATA_SOURCES_WITHIN_NO_TENURE`. |

**Excel usado por la aplicación**

| Archivo (ruta) | Hoja | Nombre en memoria | Uso (breve) | Dónde se llama |
| --- | --- | --- | --- | --- |
| `data/non_salary/tables.xlsx` | `TL All B` | `EXCEL_TABLES[["TL All B"]]` | Tabla de legislación/bonos (todos los bonuses). | `global.R` (carga). `tabs/server/non_salary.R` y `tabs/server/non_salary_cost.R` vía `get_excel_table("TL All B")`. |
| `data/non_salary/tables.xlsx` | `TL ab` | `EXCEL_TABLES[["TL ab"]]` | Tabla de legislación para bonuses tipo `ab`. | `global.R` (carga). `tabs/server/non_salary.R` y `tabs/server/non_salary_cost.R` vía `get_excel_table("TL ab")`. |
| `data/non_salary/tables.xlsx` | `TL pl` | `EXCEL_TABLES[["TL pl"]]` | Tabla de legislación para bonuses tipo `pl`. | `global.R` (carga). `tabs/server/non_salary.R` y `tabs/server/non_salary_cost.R` vía `get_excel_table("TL pl")`. |
| `data/non_salary/tables.xlsx` | `TL up` | `EXCEL_TABLES[["TL up"]]` | Tabla de legislación para bonuses tipo `up`. | `global.R` (carga). `tabs/server/non_salary.R` y `tabs/server/non_salary_cost.R` vía `get_excel_table("TL up")`. |
| `data/non_salary/tables.xlsx` | `TL Or` | `EXCEL_TABLES[["TL Or"]]` | Tabla de legislación para bonuses tipo `ob` (other bonuses). | `global.R` (carga). `tabs/server/non_salary.R` y `tabs/server/non_salary_cost.R` vía `get_excel_table("TL Or")`. |
| `data/non_salary/tables.xlsx` | `TL H` | `EXCEL_TABLES[["TL H"]]` | Tabla de legislación para componente Health. | `global.R` (carga). `tabs/server/non_salary.R` y `tabs/server/non_salary_cost.R` vía `get_excel_table("TL H")`. |
| `data/non_salary/tables.xlsx` | `TL Pt` | `EXCEL_TABLES[["TL Pt"]]` | Tabla de legislación para componente Payroll Taxes. | `global.R` (carga). `tabs/server/non_salary.R` y `tabs/server/non_salary_cost.R` vía `get_excel_table("TL Pt")`. |
| `data/non_salary/tables.xlsx` | `TL All P` | `EXCEL_TABLES[["TL All P"]]` | Tabla de legislación para componente Pensions. | `global.R` (carga). `tabs/server/non_salary.R` y `tabs/server/non_salary_cost.R` vía `get_excel_table("TL All P")`. |

**Notas rápidas**
- Todas las cargas viven en `global.R`; los módulos server consumen esos objetos ya en memoria.
- Hay archivos `.rds` en `data/non_salary/` que no están referenciados en `global.R` (por ejemplo los que tienen prefijo numérico distinto o archivos de respaldo). No se documentan aquí porque la app no los usa.
